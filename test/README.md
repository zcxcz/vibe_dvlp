# Cropæ¨¡å—å›å½’æµ‹è¯•æ¡†æ¶

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

è¿™ä¸ªæµ‹è¯•æ¡†æ¶æä¾›äº†è‡ªåŠ¨åŒ–çš„å›å½’æµ‹è¯•èƒ½åŠ›ï¼Œå¯ä»¥ï¼š
- éšæœºç”Ÿæˆå„ç§é…ç½®å‚æ•°è¿›è¡Œæµ‹è¯•
- éªŒè¯ä¸åŒå›¾åƒå°ºå¯¸å’Œè£å‰ªåŒºåŸŸçš„æ­£ç¡®æ€§
- æ”¯æŒæŒ‡å®šæµ‹è¯•æ•°é‡å’Œéšæœºç§å­
- è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•æ•°æ®ï¼Œé¿å…æ•°æ®ä¸åŒ¹é…é—®é¢˜

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åŸºæœ¬ä½¿ç”¨
```bash
# è¿è¡Œ50ä¸ªéšæœºæµ‹è¯•ç”¨ä¾‹
./test/run_test.sh 50

# è¿è¡Œ100ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼ŒæŒ‡å®šéšæœºç§å­
./test/run_test.sh 100 123456

# ä½¿ç”¨Pythonç›´æ¥è¿è¡Œ
python3 test/regression_test.py -n 100
```

### 2. é«˜çº§ç”¨æ³•
```bash
# æŒ‡å®šéšæœºç§å­è¿›è¡Œå¯é‡å¤æµ‹è¯•
python3 test/regression_test.py -n 200 -s 42 -o my_results.json

# æŸ¥çœ‹å¸®åŠ©
python3 test/regression_test.py --help
```

## ğŸ“‹ æµ‹è¯•è¦†ç›–èŒƒå›´

### æµ‹è¯•å‚æ•°èŒƒå›´
- **å›¾åƒå°ºå¯¸**: 1Ã—1 åˆ° 8Ã—8 åƒç´ 
- **è£å‰ªæ¨¡å¼**: é€ä¼ æ¨¡å¼(crop_enable=0) å’Œ è£å‰ªæ¨¡å¼(crop_enable=1)
- **è£å‰ªåŒºåŸŸ**: ä»»æ„æœ‰æ•ˆçŸ©å½¢åŒºåŸŸ
- **è¾¹ç•Œæ¡ä»¶**: å•åƒç´ è£å‰ªã€å…¨å›¾è£å‰ªã€è¾¹ç¼˜è£å‰ª

### éªŒè¯å†…å®¹
- âœ… è¾“å‡ºåƒç´ æ•°é‡æ­£ç¡®æ€§
- âœ… è£å‰ªåŒºåŸŸè®¡ç®—å‡†ç¡®æ€§
- âœ… é€ä¼ æ¨¡å¼æ•°æ®å®Œæ•´æ€§
- âœ… è¾¹ç•Œæ¡ä»¶å¤„ç†
- âœ… é…ç½®å‚æ•°æœ‰æ•ˆæ€§

## ğŸ”§ å‘½ä»¤è¡Œå‚æ•°

```
usage: regression_test.py [-h] [-n COUNT] [-s SEED] [-o OUTPUT]

Cropæ¨¡å—å›å½’æµ‹è¯•

options:
  -h, --help            æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
  -n COUNT, --count COUNT
                        æµ‹è¯•ç”¨ä¾‹æ•°é‡ (é»˜è®¤: 100)
  -s SEED, --seed SEED  éšæœºç§å­ (é»˜è®¤: å½“å‰æ—¶é—´)
  -o OUTPUT, --output OUTPUT
                        ç»“æœè¾“å‡ºæ–‡ä»¶ (é»˜è®¤: test_results.json)
```

## ğŸ“Š è¾“å‡ºè¯´æ˜

### ç»ˆç«¯è¾“å‡º
```
ğŸš€ å¼€å§‹Cropæ¨¡å—å›å½’æµ‹è¯•
ğŸ“Š æµ‹è¯•æ•°é‡: 50
ğŸ² éšæœºç§å­: 1755013373
--------------------------------------------------

ğŸ§ª æµ‹è¯• 1/50 âœ… è¾“å‡ºæ­£ç¡®: 7 pixels
ğŸ§ª æµ‹è¯• 2/50 âœ… è¾“å‡ºæ­£ç¡®: 35 pixels
...

==================================================
ğŸ“ˆ æµ‹è¯•æ€»ç»“
âœ… é€šè¿‡: 50
âŒ å¤±è´¥: 0
ğŸ“Š é€šè¿‡ç‡: 100.0%
ğŸ“‹ æµ‹è¯•ç»“æœå·²å¯¼å‡ºåˆ°: test_results.json
```

### ç»“æœæ–‡ä»¶æ ¼å¼
æµ‹è¯•å®Œæˆåä¼šç”Ÿæˆ`test_results.json`ï¼ŒåŒ…å«ï¼š
- æµ‹è¯•ç»Ÿè®¡ä¿¡æ¯
- æ¯ä¸ªæµ‹è¯•çš„è¯¦ç»†é…ç½®
- é¢„æœŸå’Œå®é™…è¾“å‡º
- å¤±è´¥ç”¨ä¾‹çš„è¯¦ç»†ä¿¡æ¯

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **"Input data size mismatch"é”™è¯¯**
   - å·²ä¿®å¤ï¼šæ¡†æ¶ç°åœ¨ä¼šè‡ªåŠ¨ç”ŸæˆåŒ¹é…å°ºå¯¸çš„æµ‹è¯•æ•°æ®

2. **"æ— æ³•è§£æè¾“å‡º"é”™è¯¯**
   - å·²ä¿®å¤ï¼šå¢å¼ºäº†è§£æé€»è¾‘ï¼Œæ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼

3. **æƒé™é—®é¢˜**
   ```bash
   chmod +x test/run_test.sh
   chmod +x test/regression_test.py
   ```

### è°ƒè¯•å•ä¸ªæµ‹è¯•

å¦‚éœ€è°ƒè¯•ç‰¹å®šé…ç½®ï¼Œå¯ä»¥æ‰‹åŠ¨è¿è¡Œï¼š
```bash
# æ‰‹åŠ¨è®¾ç½®é…ç½®
python3 -c "
import json
with open('data/vibe.json', 'r') as f:
    config = json.load(f)
config['register_info']['reg_image_width']['reg_initial_value'] = [3]
config['register_info']['reg_image_height']['reg_initial_value'] = [4]
config['register_info']['reg_crop_enable']['reg_initial_value'] = [1]
config['register_info']['reg_crop_start_x']['reg_initial_value'] = [1]
config['register_info']['reg_crop_start_y']['reg_initial_value'] = [1]
config['register_info']['reg_crop_end_x']['reg_initial_value'] = [2]
config['register_info']['reg_crop_end_y']['reg_initial_value'] = [2]
with open('data/vibe.json', 'w') as f:
    json.dump(config, f, indent=2)
"

# ç”Ÿæˆæµ‹è¯•æ•°æ®
echo -e "1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12" > data/image.txt

# è¿è¡Œæµ‹è¯•
./build/vibe
```

## ğŸ¯ æœ€ä½³å®è·µ

### æŒç»­é›†æˆ
```bash
# åœ¨CI/CDä¸­è¿è¡Œ
./test/run_test.sh 1000  # å¤§é‡æµ‹è¯•ç¡®ä¿ç¨³å®šæ€§
```

### å›å½’éªŒè¯
```bash
# éªŒè¯ä»£ç ä¿®æ”¹åæ˜¯å¦å¼•å…¥bug
./test/run_test.sh 50 $(date +%s)  # ä½¿ç”¨å½“å‰æ—¶é—´ä½œä¸ºç§å­
```

### è¾¹ç•Œæµ‹è¯•
```bash
# æµ‹è¯•è¾¹ç•Œæ¡ä»¶
python3 test/regression_test.py -n 200 -s 1 -o boundary_test.json
```